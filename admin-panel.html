<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>

    <header>
        <div class="container nav-flex">
            <div class="logo">Admin Dashboard</div>
            <nav>
                <a href="status.html" class="btn-nav">Student Status</a>
                <button onclick="logout()" class="btn-nav btn-logout">Logout</button>
            </nav>
        </div>
    </header>

    <div class="container animate-fade">
        <div class="dashboard-grid">
            <div class="card">
                <h3>Total Collected</h3>
                <div id="totalIn" class="stat-value">...</div>
            </div>
            <div class="card expense">
                <h3>Total Expenses</h3>
                <div id="totalOut" class="stat-value red">...</div>
            </div>
            <div class="card green-accent">
                <h3>Net Balance</h3>
                <div id="netBal" class="stat-value green">...</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h3><i class="bi bi-person-plus-fill"></i> Add Student Payment</h3>
                <br>
                <input type="text" id="sName" placeholder="Student Name" class="form-group">
                <input type="text" id="sId" placeholder="ICBT ID" class="form-group">
                <input type="number" id="sPrice" placeholder="Amount (LKR)" class="form-group">
                <select id="sStatus" class="form-group">
                    <option value="Paid">Paid</option>
                    <option value="Pending">Pending</option>
                    <option value="Not Paid">Not Paid</option>
                </select>
                <button id="btnAddStudent" class="btn-action">Add Record</button>
            </div>

            <div class="card">
                <h3><i class="bi bi-cart-dash-fill"></i> Add Expense</h3>
                <br>
                <input type="text" id="eName" placeholder="Description (e.g. Bus Rent)" class="form-group">
                <input type="number" id="eAmount" placeholder="Cost (LKR)" class="form-group">
                <button id="btnAddExpense" class="btn-action" style="background:var(--primary-red)">Record Expense</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { requireAuth, loadDashboardData, addStudent, addExpense } from './assets/js/app.js';
        
        requireAuth(); // Security Check

        // Load Stats
        loadDashboardData({
            onTotals: (inc, exp, bal) => {
                document.getElementById('totalIn').innerText = 'LKR ' + inc.toLocaleString();
                document.getElementById('totalOut').innerText = 'LKR ' + exp.toLocaleString();
                document.getElementById('netBal').innerText = 'LKR ' + bal.toLocaleString();
            }
        });

        // Event Listeners
        document.getElementById('btnAddStudent').addEventListener('click', () => {
            addStudent(
                document.getElementById('sName').value,
                document.getElementById('sId').value,
                document.getElementById('sPrice').value,
                document.getElementById('sStatus').value
            );
        });

        document.getElementById('btnAddExpense').addEventListener('click', () => {
            addExpense(
                document.getElementById('eName').value,
                document.getElementById('eAmount').value
            );
        });
    </script>
</body>
</html>